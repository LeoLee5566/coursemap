
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <title>UBC Mathematics Undergraduate Program</title>
  </head>
  <body>

    <svg></svg>

    <script type="text/javascript">

      d3.csv("data/csv/LayoutCourses.csv").then(function (courses) {
        d3.csv("data/csv/LayoutRequisites.csv").then(function (requisites) {

          var width = 1000, height = 500, scale = 50;
          var xcoord = x => x*scale + width/2;
          var ycoord = y => height - 30 - y*scale;

          var svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height)
                      .style("border","1px solid black");
          var x_1 = xcoord(requisites[0].course_x);

          function draw(context) {
            context.moveTo(10, 10);
            context.arcTo(100, 150, 300, 10, 40);
            context.lineTo(10, 50); // draw an arc, the turtle ends up at ⟨194.4,108.5⟩
            // draw straight line to ⟨300,10⟩
            // etc.
            return context; // not mandatory, but will make it easier to chain operations
          }




        /*.append("line")          // attach a line
                  .style("stroke", "black")  // colour the line
                  .attr("x1", 500)     // x position of the first end of the line
                  .attr("y1", 470)      // y position of the first end of the line
                  .attr("x2", 300)     // x position of the second end of the line
                  .attr("y2", 150);*/


          svg.selectAll("circle")
            .data(courses)
            .join("circle")
            .attr("r", 5)
            .attr("cx", course => xcoord(course.x))
            .attr("cy", course => ycoord(course.y))
            .attr("fill","rgb(0,0,0)");

          var link = d3.linkHorizontal().source(function (d) { return { x: d.x1, y: d.y1 }; })
                  .target(function (d) { return { x: d.x2, y: d.y2 }; })
                  .x(function(d) {
                    console.log(d.x)
                    return d.x;
                  })
                  .y(function(d) {
                    console.log(d.y)
                    return d.y;
                  });
                  
          var arc = function(d) {
            var dx = xcoord(d.requisite_x) - xcoord(d.course_x);
            dy = ycoord(d.requisite_y) - ycoord(d.course_y);
            dr = Math.sqrt(dx * dx + dy * dy);
            return "M" + xcoord(d.course_x) + "," + ycoord(d.course_y) + "A" + dr + "," + dr +
                    " 0 0,1 " + xcoord(d.requisite_x) + "," + ycoord(d.requisite_y);
          }


          var diagonal = d3.linkHorizontal()
                  .source(function (d) { return { x: xcoord(d.course_x), y: ycoord(d.course_y) }; })
                  .target(function (d) { return { x: xcoord(d.requisite_x), y: ycoord(d.requisite_y) }; })
                  .x(function(d) {
                    return d.x;
                  })
                  .y(function(d) {
                    return d.y;
                  });
          console.log(courses)

          var link = d3.linkRadial()
                  .angle(function(d) { return d.x; })
                  .radius(function(d) { return d.y; });
          /*svg.append("path")
                  .attr("d", link(courses))
                  .attr('transform', 'translate(' + 150 + ',' + 150 + ')')
                  .style("fill", "none")
                  .style("stroke", "darkslateblue")
                  .style("stroke-width", "4px");*/
          var data = {
            source: {
              x: null,
              y: null
            },
            target: {
              x: null,
              y: null
            }}
          /*console.log(data.source.x);
            console.log(data.source.y);
          console.log(data.target.x);
          console.log(data.target.y);
          svg.append("path")
                  .attr("d", link(data))
                  .attr('transform', 'translate(' + xcoord(-2) + ',' + ycoord(1) + ')')
                  .style("fill", "none")
                  .style("stroke", "darkslateblue")
                  .style("stroke-width", "4px");*/


         var adjust = x => {
           var n = x/30 * Math.PI;
           console.log(n);
           if (n <= Math.PI/2) {
             return (Math.PI/2)-n;}
           else{
               return Math.PI -n + (3/2 * Math.PI);
             }
           }


          for (i = 0; i < requisites.length ; i++) {
            for (j = 0; j < courses.length; j++){
              if (courses[j].course_number ==  requisites[i].requisite_number){
                 data.source.x = adjust(courses[j].theta);
                 data.source.y = (courses[j].r)*50;
               }
              if (courses[j].course_number ==  requisites[i].course_number){
                data.target.x = adjust(courses[j].theta);
                ;
                data.target.y = (courses[j].r)*50;
              }}
              //console.log(data.source.x);
              //console.log(data.target.x);
                      svg.append("path")
                    .attr("d", link(data))
                    .attr('transform', 'translate(' + 500 + ',' + 470 + ')')
                    .style("fill", "none")
                    .style("stroke", "darkslateblue")
                    .style("stroke-width", 2);
          }

          /*svg.selectAll('path')
                  .data([requisites[0],requisites[1],requisites[2]])
                  .join('path')
                  .attr('class', 'link')
                  .attr('d',diagonal)
                  .attr("stroke","rgba(0,0,0,0.2)")
                  .attr('stroke-width', 2)
                  .attr('fill', 'none');*/

          /*svg.selectAll("line")
            .data(requisites)
            .join("line")
            .attr("x1", requisite => xcoord(requisite.course_x))
            .attr("y1", requisite => ycoord(requisite.course_y))
            .attr("x2", requisite => xcoord(requisite.requisite_x))
            .attr("y2", requisite => ycoord(requisite.requisite_y))
            .attr("stroke","rgba(0,0,0,0.2)");*/

        })
      });

    </script>
  </body>
</html>
