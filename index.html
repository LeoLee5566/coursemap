<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <title>UBC Mathematics Undergraduate Program</title>
</head>

<body>
    <style>
        .course {
            r: 15px;
            fill: #EECDA3;
            opacity: 0.8;
            stroke: #8c0044;
            stroke-width: 1px;
        }
        
        .pre_line {
            stroke: rgba(0, 0, 0, 0.2);
            stroke-width: 1px;
        }
    </style>
    <svg></svg>

    <script type="text/javascript">
        Promise.all([
            d3.csv("data/csv/LayoutCourses.csv"),
            d3.csv("data/csv/LayoutRequisites.csv"),
            d3.csv("data/csv/Courses.csv"),
        ]).then(function(files) {
            const courses = files[0];
            const requisites = files[1];
            const coursesinfo = files[2];

            const width = 1400,
                height = 700,
                scale = 80;
            var xcoord = x => x * scale + width / 2;
            var ycoord = y => height - 30 - y * scale;
            var pre_line = (a, b) => a + "-" + b;

            var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .style("border", "1px solid black");

            var lines = svg.selectAll("line")
                .data(requisites)

            lines.join("line")
                .attr("id", requisite => pre_line(requisite.course_number, requisite.requisite_number))
                .attr("class", "pre_line")
                .attr("x1", requisite => xcoord(requisite.course_x))
                .attr("y1", requisite => ycoord(requisite.course_y))
                .attr("x2", requisite => xcoord(requisite.requisite_x))
                .attr("y2", requisite => ycoord(requisite.requisite_y));


            var nodes = svg.selectAll("circle")
                .data(courses).join("g");

            nodes.append("circle")
                .attr("id", course => course.course_number)
                .attr("class", "course")
                .attr("cx", course => xcoord(course.x))
                .attr("cy", course => ycoord(course.y));

            nodes.append("text")
                .attr("id", course => course.course_number)
                .attr("class", "course_num")
                .attr("x", course => xcoord(course.x))
                .attr("y", course => ycoord(course.y) + 5)
                .attr("text-anchor", "middle")
                .attr("font-size", 14)
                .text(d => d.course_number);

        });
    </script>
</body>

</html>